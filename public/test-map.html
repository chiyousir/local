<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å›¾æµ‹è¯•é¡µé¢</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .map-container {
            width: 100%;
            height: 400px;
            border: 2px solid #333;
            margin-top: 10px;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ—ºï¸ åœ°å›¾åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>1. Leafletåº“åŠ è½½æµ‹è¯•</h3>
            <div id="leafletStatus" class="status info">æ£€æŸ¥ä¸­...</div>
            <button onclick="testLeaflet()">é‡æ–°æµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h3>2. åœ°å›¾å®¹å™¨æµ‹è¯•</h3>
            <div id="containerStatus" class="status info">æ£€æŸ¥ä¸­...</div>
            <button onclick="testContainer()">é‡æ–°æµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h3>3. åœ°å›¾ç“¦ç‰‡åŠ è½½æµ‹è¯•</h3>
            <div id="tileStatus" class="status info">æ£€æŸ¥ä¸­...</div>
            <button onclick="testTiles()">é‡æ–°æµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h3>4. åœ°å›¾æ˜¾ç¤ºæµ‹è¯•</h3>
            <div id="mapStatus" class="status info">æ£€æŸ¥ä¸­...</div>
            <div class="map-container" id="testMap"></div>
            <button onclick="initTestMap()">åˆå§‹åŒ–åœ°å›¾</button>
            <button onclick="testMarkers()">æ·»åŠ æ ‡è®°</button>
        </div>
        
        <div class="test-section">
            <h3>5. æ§åˆ¶å°æ—¥å¿—</h3>
            <div id="consoleLog" class="log"></div>
            <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div class="test-section">
            <h3>6. ç½‘ç»œè¿æ¥æµ‹è¯•</h3>
            <div id="networkStatus" class="status info">æ£€æŸ¥ä¸­...</div>
            <button onclick="testNetwork()">é‡æ–°æµ‹è¯•</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let testMap = null;
        let logContainer = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logContainer = document.getElementById('consoleLog');
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•...');
            
            // è¿è¡Œæ‰€æœ‰æµ‹è¯•
            setTimeout(() => {
                testLeaflet();
                testContainer();
                testNetwork();
                testTiles();
                initTestMap();
            }, 500);
        });

        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            console.log(logEntry);
            
            if (logContainer) {
                logContainer.innerHTML += logEntry + '\n';
                logContainer.scrollTop = logContainer.scrollHeight;
            }
        }

        function clearLog() {
            if (logContainer) {
                logContainer.innerHTML = '';
            }
        }

        // æµ‹è¯•Leafletåº“
        function testLeaflet() {
            const statusEl = document.getElementById('leafletStatus');
            
            if (typeof L !== 'undefined') {
                statusEl.className = 'status success';
                statusEl.textContent = `âœ… Leafletåº“åŠ è½½æˆåŠŸ (ç‰ˆæœ¬: ${L.version})`;
                log('Leafletåº“åŠ è½½æˆåŠŸ');
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ Leafletåº“åŠ è½½å¤±è´¥';
                log('Leafletåº“åŠ è½½å¤±è´¥');
            }
        }

        // æµ‹è¯•åœ°å›¾å®¹å™¨
        function testContainer() {
            const statusEl = document.getElementById('containerStatus');
            const container = document.getElementById('testMap');
            
            if (container) {
                const rect = container.getBoundingClientRect();
                if (rect.width > 0 && rect.height > 0) {
                    statusEl.className = 'status success';
                    statusEl.textContent = `âœ… åœ°å›¾å®¹å™¨æ­£å¸¸ (${rect.width}x${rect.height})`;
                    log(`åœ°å›¾å®¹å™¨å°ºå¯¸: ${rect.width}x${rect.height}`);
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âŒ åœ°å›¾å®¹å™¨å°ºå¯¸ä¸º0';
                    log('åœ°å›¾å®¹å™¨å°ºå¯¸ä¸º0');
                }
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ æ‰¾ä¸åˆ°åœ°å›¾å®¹å™¨';
                log('æ‰¾ä¸åˆ°åœ°å›¾å®¹å™¨');
            }
        }

        // æµ‹è¯•ç½‘ç»œè¿æ¥
        function testNetwork() {
            const statusEl = document.getElementById('networkStatus');
            
            // æµ‹è¯•é«˜å¾·åœ°å›¾è¿æ¥
            const img = new Image();
            img.onload = function() {
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¯ä»¥è®¿é—®å›½å†…åœ°å›¾æœåŠ¡';
                log('ç½‘ç»œè¿æ¥æµ‹è¯•æˆåŠŸ');
            };
            img.onerror = function() {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œæ— æ³•è®¿é—®åœ°å›¾æœåŠ¡';
                log('ç½‘ç»œè¿æ¥æµ‹è¯•å¤±è´¥');
            };
            img.src = 'https://webrd01.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x=512&y=512&z=10';
        }

        // æµ‹è¯•åœ°å›¾ç“¦ç‰‡
        function testTiles() {
            const statusEl = document.getElementById('tileStatus');
            
            if (typeof L === 'undefined') {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ Leafletåº“æœªåŠ è½½ï¼Œæ— æ³•æµ‹è¯•ç“¦ç‰‡';
                return;
            }

            try {
                const testTileLayer = L.tileLayer('https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
                    attribution: 'Â© é«˜å¾·åœ°å›¾',
                    maxZoom: 18,
                    subdomains: ['1', '2', '3', '4']
                });
                
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… åœ°å›¾ç“¦ç‰‡é…ç½®æ­£å¸¸';
                log('åœ°å›¾ç“¦ç‰‡é…ç½®æµ‹è¯•æˆåŠŸ');
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `âŒ åœ°å›¾ç“¦ç‰‡é…ç½®é”™è¯¯: ${error.message}`;
                log(`åœ°å›¾ç“¦ç‰‡é…ç½®é”™è¯¯: ${error.message}`);
            }
        }

        // åˆå§‹åŒ–æµ‹è¯•åœ°å›¾
        function initTestMap() {
            const statusEl = document.getElementById('mapStatus');
            
            if (typeof L === 'undefined') {
                statusEl.className = 'status error';
                statusEl.textContent = 'âŒ Leafletåº“æœªåŠ è½½';
                return;
            }

            try {
                // æ¸…é™¤ç°æœ‰åœ°å›¾
                if (testMap) {
                    testMap.remove();
                }

                // åˆ›å»ºæ–°åœ°å›¾
                testMap = L.map('testMap').setView([39.9042, 116.4074], 10);

                // æ·»åŠ ç“¦ç‰‡å±‚ï¼ˆä½¿ç”¨é«˜å¾·åœ°å›¾ï¼‰
                L.tileLayer('https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
                    attribution: 'Â© é«˜å¾·åœ°å›¾',
                    maxZoom: 18,
                    subdomains: ['1', '2', '3', '4']
                }).addTo(testMap);

                // ç›‘å¬åœ°å›¾äº‹ä»¶
                testMap.on('load', () => {
                    statusEl.className = 'status success';
                    statusEl.textContent = 'âœ… åœ°å›¾åˆå§‹åŒ–æˆåŠŸ';
                    log('åœ°å›¾åˆå§‹åŒ–æˆåŠŸ');
                });

                testMap.on('tileerror', (e) => {
                    log(`åœ°å›¾ç“¦ç‰‡é”™è¯¯: ${e.tile.src}`);
                });

                statusEl.className = 'status info';
                statusEl.textContent = 'ğŸ”„ æ­£åœ¨åˆå§‹åŒ–åœ°å›¾...';
                log('å¼€å§‹åˆå§‹åŒ–åœ°å›¾');

            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = `âŒ åœ°å›¾åˆå§‹åŒ–å¤±è´¥: ${error.message}`;
                log(`åœ°å›¾åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
            }
        }

        // æµ‹è¯•æ ‡è®°
        function testMarkers() {
            if (!testMap) {
                log('åœ°å›¾æœªåˆå§‹åŒ–ï¼Œæ— æ³•æ·»åŠ æ ‡è®°');
                return;
            }

            try {
                // æ·»åŠ æµ‹è¯•æ ‡è®°
                const marker = L.marker([39.9042, 116.4074]).addTo(testMap);
                marker.bindPopup('æµ‹è¯•æ ‡è®° - åŒ—äº¬').openPopup();
                
                log('æˆåŠŸæ·»åŠ æµ‹è¯•æ ‡è®°');
            } catch (error) {
                log(`æ·»åŠ æ ‡è®°å¤±è´¥: ${error.message}`);
            }
        }
    </script>
</body>
</html>
